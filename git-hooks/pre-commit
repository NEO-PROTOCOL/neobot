#!/bin/sh
ROOT=$(git rev-parse --show-toplevel 2>/dev/null)
[ -z "$ROOT" ] && exit 0

echo "$FILES" | xargs pnpm lint --fix
echo "$FILES" | xargs pnpm format --no-error-on-unmatched-pattern
echo "$FILES" | xargs git add

# 2. Format staged files
NODE_BIN=$(command -v node 2>/dev/null || echo "")
if [ -z "$NODE_BIN" ]; then
    # Try nvm default location
    for d in "$HOME/.nvm/versions/node"/*/bin/node; do
        [ -x "$d" ] && NODE_BIN="$d" && break
    done
fi
if [ -n "$NODE_BIN" ]; then
    "$NODE_BIN" "$ROOT/scripts/format-staged.js" 2>/dev/null || true
fi

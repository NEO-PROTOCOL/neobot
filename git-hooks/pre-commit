#!/bin/sh
ROOT=$(git rev-parse --show-toplevel 2>/dev/null)
[ -z "$ROOT" ] && exit 0

# 1. Check for secrets first (most important)
if [ -x "$ROOT/git-hooks/pre-commit-secrets" ]; then
    "$ROOT/git-hooks/pre-commit-secrets" || exit 1
fi

# 2. Format staged files
NODE_BIN=$(command -v node 2>/dev/null || echo "")
if [ -z "$NODE_BIN" ]; then
    # Try nvm default location
    for d in "$HOME/.nvm/versions/node"/*/bin/node; do
        [ -x "$d" ] && NODE_BIN="$d" && break
    done
fi
if [ -n "$NODE_BIN" ]; then
    "$NODE_BIN" "$ROOT/scripts/format-staged.js" 2>/dev/null || true
fi

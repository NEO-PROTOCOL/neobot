{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{spawn}from\"node:child_process\";import path from\"node:path\";import fs from\"node:fs\";import{appendLedgerEvent,createEventId}from\"../ledger/ledger.js\";function existsOrThrow(p){if(!fs.existsSync(p))throw new Error(`Missing file: ${p}`)}__name(existsOrThrow,\"existsOrThrow\");async function runShellSkill(params){const{skill,scriptPath,args=[],risk=\"low\",channel=\"cli\",actor=\"user\"}=params;const resolved=path.resolve(process.cwd(),scriptPath);existsOrThrow(resolved);const eventId=createEventId(\"evt\");const startedAt=Date.now();let stdout=\"\";let stderr=\"\";return await new Promise(resolve=>{const child=spawn(\"bash\",[resolved,...args],{cwd:process.cwd(),stdio:[\"ignore\",\"pipe\",\"pipe\"],env:process.env});child.stdout.on(\"data\",d=>stdout+=d.toString());child.stderr.on(\"data\",d=>stderr+=d.toString());child.on(\"close\",code=>{const duration_ms=Date.now()-startedAt;const ok=code===0;appendLedgerEvent({id:eventId,ts:new Date().toISOString(),actor,channel,skill,intent:`run ${skill}`,status:ok?\"success\":\"error\",duration_ms,risk,error:ok?null:stderr||`Exit code ${code}`,agent_id:\"core\",parent_event_id:null});resolve({ok,exitCode:code,stdout,stderr,duration_ms,eventId})})})}__name(runShellSkill,\"runShellSkill\");export{runShellSkill};\n","warnings":[],"map":{"version":3,"mappings":"kHAAA,OAAS,UAAa,qBACtB,OAAO,SAAU,YACjB,OAAO,OAAQ,UAEf,OAAS,kBAAmB,kBAAsC,sBAoBlE,SAAS,cAAc,EAAW,CAChC,GAAI,CAAC,GAAG,WAAW,CAAC,EAAG,MAAM,IAAI,MAAM,iBAAiB,CAAC,EAAE,CAC7D,CAFS,sCAIT,eAAsB,cAAc,OAA2D,CAC7F,KAAM,CAAE,MAAO,WAAY,KAAO,CAAC,EAAG,KAAO,MAAO,QAAU,MAAO,MAAQ,MAAO,EAAI,OAExF,MAAM,SAAW,KAAK,QAAQ,QAAQ,IAAI,EAAG,UAAU,EACvD,cAAc,QAAQ,EAEtB,MAAM,QAAU,cAAc,KAAK,EACnC,MAAM,UAAY,KAAK,IAAI,EAE3B,IAAI,OAAS,GACb,IAAI,OAAS,GAEb,OAAO,MAAM,IAAI,QAAS,SAAY,CACpC,MAAM,MAAQ,MAAM,OAAQ,CAAC,SAAU,GAAG,IAAI,EAAG,CAC/C,IAAK,QAAQ,IAAI,EACjB,MAAO,CAAC,SAAU,OAAQ,MAAM,EAChC,IAAK,QAAQ,GACf,CAAC,EAED,MAAM,OAAO,GAAG,OAAS,GAAO,QAAU,EAAE,SAAS,CAAE,EACvD,MAAM,OAAO,GAAG,OAAS,GAAO,QAAU,EAAE,SAAS,CAAE,EAEvD,MAAM,GAAG,QAAU,MAAS,CAC1B,MAAM,YAAc,KAAK,IAAI,EAAI,UACjC,MAAM,GAAK,OAAS,EAEpB,kBAAkB,CAChB,GAAI,QACJ,GAAI,IAAI,KAAK,EAAE,YAAY,EAC3B,MACA,QACA,MACA,OAAQ,OAAO,KAAK,GACpB,OAAQ,GAAK,UAAY,QACzB,YACA,KACA,MAAO,GAAK,KAAO,QAAU,aAAa,IAAI,GAC9C,SAAU,OACV,gBAAiB,IACnB,CAAC,EAED,QAAQ,CACN,GACA,SAAU,KACV,OACA,OACA,YACA,OACF,CAAC,CACH,CAAC,CACH,CAAC,CACH,CAnDsB","names":[],"ignoreList":[],"sources":["/Users/nettomello/CODIGOS/neobot/src/infra/runner/run-shell-skill.ts"],"sourcesContent":[null]}}
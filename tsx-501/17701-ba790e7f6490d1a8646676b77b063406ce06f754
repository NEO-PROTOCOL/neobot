{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import JSON5 from\"json5\";import{readConfigFileSnapshot,writeConfigFile}from\"../config/config.js\";import{danger,info}from\"../globals.js\";import{defaultRuntime}from\"../runtime.js\";import{formatDocsLink}from\"../terminal/links.js\";import{formatCliCommand}from\"./command-format.js\";import{theme}from\"../terminal/theme.js\";import{shortenHomePath}from\"../utils.js\";function isIndexSegment(raw){return/^[0-9]+$/.test(raw)}__name(isIndexSegment,\"isIndexSegment\");function parsePath(raw){const trimmed=raw.trim();if(!trimmed)return[];const parts=[];let current=\"\";let i=0;while(i<trimmed.length){const ch=trimmed[i];if(ch===\"\\\\\"){const next=trimmed[i+1];if(next)current+=next;i+=2;continue}if(ch===\".\"){if(current)parts.push(current);current=\"\";i+=1;continue}if(ch===\"[\"){if(current)parts.push(current);current=\"\";const close=trimmed.indexOf(\"]\",i);if(close===-1)throw new Error(`Invalid path (missing \"]\"): ${raw}`);const inside=trimmed.slice(i+1,close).trim();if(!inside)throw new Error(`Invalid path (empty \"[]\"): ${raw}`);parts.push(inside);i=close+1;continue}current+=ch;i+=1}if(current)parts.push(current);return parts.map(part=>part.trim()).filter(Boolean)}__name(parsePath,\"parsePath\");function parseValue(raw,opts){const trimmed=raw.trim();if(opts.json){try{return JSON5.parse(trimmed)}catch(err){throw new Error(`Failed to parse JSON5 value: ${String(err)}`)}}try{return JSON5.parse(trimmed)}catch{return raw}}__name(parseValue,\"parseValue\");function getAtPath(root,path){let current=root;for(const segment of path){if(!current||typeof current!==\"object\")return{found:false};if(Array.isArray(current)){if(!isIndexSegment(segment))return{found:false};const index=Number.parseInt(segment,10);if(!Number.isFinite(index)||index<0||index>=current.length){return{found:false}}current=current[index];continue}const record=current;if(!(segment in record))return{found:false};current=record[segment]}return{found:true,value:current}}__name(getAtPath,\"getAtPath\");function setAtPath(root,path,value){let current=root;for(let i=0;i<path.length-1;i+=1){const segment=path[i];const next=path[i+1];const nextIsIndex=Boolean(next&&isIndexSegment(next));if(Array.isArray(current)){if(!isIndexSegment(segment)){throw new Error(`Expected numeric index for array segment \"${segment}\"`)}const index=Number.parseInt(segment,10);const existing2=current[index];if(!existing2||typeof existing2!==\"object\"){current[index]=nextIsIndex?[]:{}}current=current[index];continue}if(!current||typeof current!==\"object\"){throw new Error(`Cannot traverse into \"${segment}\" (not an object)`)}const record=current;const existing=record[segment];if(!existing||typeof existing!==\"object\"){record[segment]=nextIsIndex?[]:{}}current=record[segment]}const last=path[path.length-1];if(Array.isArray(current)){if(!isIndexSegment(last)){throw new Error(`Expected numeric index for array segment \"${last}\"`)}const index=Number.parseInt(last,10);current[index]=value;return}if(!current||typeof current!==\"object\"){throw new Error(`Cannot set \"${last}\" (parent is not an object)`)}current[last]=value}__name(setAtPath,\"setAtPath\");function unsetAtPath(root,path){let current=root;for(let i=0;i<path.length-1;i+=1){const segment=path[i];if(!current||typeof current!==\"object\")return false;if(Array.isArray(current)){if(!isIndexSegment(segment))return false;const index=Number.parseInt(segment,10);if(!Number.isFinite(index)||index<0||index>=current.length)return false;current=current[index];continue}const record2=current;if(!(segment in record2))return false;current=record2[segment]}const last=path[path.length-1];if(Array.isArray(current)){if(!isIndexSegment(last))return false;const index=Number.parseInt(last,10);if(!Number.isFinite(index)||index<0||index>=current.length)return false;current.splice(index,1);return true}if(!current||typeof current!==\"object\")return false;const record=current;if(!(last in record))return false;delete record[last];return true}__name(unsetAtPath,\"unsetAtPath\");async function loadValidConfig(){const snapshot=await readConfigFileSnapshot();if(snapshot.valid)return snapshot;defaultRuntime.error(`Config invalid at ${shortenHomePath(snapshot.path)}.`);for(const issue of snapshot.issues){defaultRuntime.error(`- ${issue.path||\"<root>\"}: ${issue.message}`)}defaultRuntime.error(`Run \\`${formatCliCommand(\"moltbot doctor\")}\\` to repair, then retry.`);defaultRuntime.exit(1);return snapshot}__name(loadValidConfig,\"loadValidConfig\");function registerConfigCli(program){const cmd=program.command(\"config\").description(\"Config helpers (get/set/unset). Run without subcommand for the wizard.\").addHelpText(\"after\",()=>`\n${theme.muted(\"Docs:\")} ${formatDocsLink(\"/cli/config\",\"docs.molt.bot/cli/config\")}\n`).option(\"--section <section>\",\"Configure wizard sections (repeatable). Use with no subcommand.\",(value,previous)=>[...previous,value],[]).action(async opts=>{const{CONFIGURE_WIZARD_SECTIONS,configureCommand,configureCommandWithSections}=await import(\"../commands/configure.js\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s});const sections=Array.isArray(opts.section)?opts.section.map(value=>typeof value===\"string\"?value.trim():\"\").filter(Boolean):[];if(sections.length===0){await configureCommand(defaultRuntime);return}const invalid=sections.filter(s=>!CONFIGURE_WIZARD_SECTIONS.includes(s));if(invalid.length>0){defaultRuntime.error(`Invalid --section: ${invalid.join(\", \")}. Expected one of: ${CONFIGURE_WIZARD_SECTIONS.join(\", \")}.`);defaultRuntime.exit(1);return}await configureCommandWithSections(sections,defaultRuntime)});cmd.command(\"get\").description(\"Get a config value by dot path\").argument(\"<path>\",\"Config path (dot or bracket notation)\").option(\"--json\",\"Output JSON\",false).action(async(path,opts)=>{try{const parsedPath=parsePath(path);if(parsedPath.length===0){throw new Error(\"Path is empty.\")}const snapshot=await loadValidConfig();const res=getAtPath(snapshot.config,parsedPath);if(!res.found){defaultRuntime.error(danger(`Config path not found: ${path}`));defaultRuntime.exit(1);return}if(opts.json){defaultRuntime.log(JSON.stringify(res.value??null,null,2));return}if(typeof res.value===\"string\"||typeof res.value===\"number\"||typeof res.value===\"boolean\"){defaultRuntime.log(String(res.value));return}defaultRuntime.log(JSON.stringify(res.value??null,null,2))}catch(err){defaultRuntime.error(danger(String(err)));defaultRuntime.exit(1)}});cmd.command(\"set\").description(\"Set a config value by dot path\").argument(\"<path>\",\"Config path (dot or bracket notation)\").argument(\"<value>\",\"Value (JSON5 or raw string)\").option(\"--json\",\"Parse value as JSON5 (required)\",false).action(async(path,value,opts)=>{try{const parsedPath=parsePath(path);if(parsedPath.length===0)throw new Error(\"Path is empty.\");const parsedValue=parseValue(value,opts);const snapshot=await loadValidConfig();const next=snapshot.config;setAtPath(next,parsedPath,parsedValue);await writeConfigFile(next);defaultRuntime.log(info(`Updated ${path}. Restart the gateway to apply.`))}catch(err){defaultRuntime.error(danger(String(err)));defaultRuntime.exit(1)}});cmd.command(\"unset\").description(\"Remove a config value by dot path\").argument(\"<path>\",\"Config path (dot or bracket notation)\").action(async path=>{try{const parsedPath=parsePath(path);if(parsedPath.length===0)throw new Error(\"Path is empty.\");const snapshot=await loadValidConfig();const next=snapshot.config;const removed=unsetAtPath(next,parsedPath);if(!removed){defaultRuntime.error(danger(`Config path not found: ${path}`));defaultRuntime.exit(1);return}await writeConfigFile(next);defaultRuntime.log(info(`Removed ${path}. Restart the gateway to apply.`))}catch(err){defaultRuntime.error(danger(String(err)));defaultRuntime.exit(1)}})}__name(registerConfigCli,\"registerConfigCli\");export{registerConfigCli};\n","warnings":[],"map":{"version":3,"mappings":"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","names":["existing","record"],"ignoreList":[],"sources":["/Users/nettomello/CODIGOS/neobot/src/cli/config-cli.ts"],"sourcesContent":[null]}}
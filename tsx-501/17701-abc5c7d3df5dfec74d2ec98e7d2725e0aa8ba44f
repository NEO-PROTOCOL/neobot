{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{ethers}from\"ethers\";class MioIdentityManager{static{__name(this,\"MioIdentityManager\")}wallet;constructor(privateKey){if(!privateKey){throw new Error(\"Private key is required\")}const cleanKey=privateKey.startsWith(\"0x\")?privateKey:`0x${privateKey}`;try{this.wallet=new ethers.Wallet(cleanKey)}catch(error){throw new Error(`Invalid private key: ${String(error)}`)}}async createIdentity(metadata,options){const publicKey=this.wallet.address;const id=generateMioId(publicKey);const identity={id,publicKey,roles:options?.roles||[\"user\"],permissions:options?.permissions||{channels:[],skills:[],tools:[\"read\"]},metadata,createdAt:new Date};const message=this.createCanonicalMessage(identity);const signature=await this.wallet.signMessage(message);const fullIdentity={...identity,signature};return fullIdentity}async verifyIdentity(identity){try{const identityWithoutSignature={id:identity.id,publicKey:identity.publicKey,roles:identity.roles,permissions:identity.permissions,metadata:identity.metadata,createdAt:identity.createdAt};const message=this.createCanonicalMessage(identityWithoutSignature);const recoveredAddress=ethers.verifyMessage(message,identity.signature);const isValid=recoveredAddress.toLowerCase()===identity.publicKey.toLowerCase();const expectedId=generateMioId(identity.publicKey);const idMatches=identity.id===expectedId;return isValid&&idMatches}catch(error){console.error(\"Identity verification failed:\",error);return false}}async signMessage(message){return await this.wallet.signMessage(message)}createCanonicalMessage(identity){const canonical={id:identity.id,publicKey:identity.publicKey,roles:identity.roles.sort(),permissions:{channels:identity.permissions.channels.sort(),skills:identity.permissions.skills.sort(),tools:identity.permissions.tools.sort()},metadata:identity.metadata,createdAt:identity.createdAt.toISOString()};return JSON.stringify(canonical)}toJSON(identity){return JSON.stringify(identity,null,2)}fromJSON(json){const parsed=JSON.parse(json);if(typeof parsed.createdAt===\"string\"){parsed.createdAt=new Date(parsed.createdAt)}return parsed}getPublicKey(){return this.wallet.address}getMioId(){return generateMioId(this.wallet.address)}}function createMioIdentityManager(privateKey){return new MioIdentityManager(privateKey)}__name(createMioIdentityManager,\"createMioIdentityManager\");function generatePrivateKey(){const wallet=ethers.Wallet.createRandom();return wallet.privateKey}__name(generatePrivateKey,\"generatePrivateKey\");async function generateIdentities(count){const identities=[];for(let i=0;i<count;i++){const privateKey=generatePrivateKey();const manager=new MioIdentityManager(privateKey);const publicKey=manager.getPublicKey();const mioId=manager.getMioId();identities.push({privateKey,publicKey,mioId})}return identities}__name(generateIdentities,\"generateIdentities\");function isValidMioId(id){return/^mio-[a-f0-9]{8}$/i.test(id)}__name(isValidMioId,\"isValidMioId\");function generateMioId(publicKey){const hash=publicKey.replace(/^0x/,\"\").slice(0,8).toLowerCase();return`mio-${hash}`}__name(generateMioId,\"generateMioId\");export{MioIdentityManager,createMioIdentityManager,generateIdentities,generateMioId,generatePrivateKey,isValidMioId};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/nettomello/CODIGOS/neobot/src/neo/identity/mio-system.ts"],"sourcesContent":[null]}}
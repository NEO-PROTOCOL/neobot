{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{readConfigFileSnapshot}from\"../../config/config.js\";import{loadAndMaybeMigrateDoctorConfig}from\"../../commands/doctor-config-flow.js\";import{colorize,isRich,theme}from\"../../terminal/theme.js\";import{formatCliCommand}from\"../command-format.js\";import{shortenHomePath}from\"../../utils.js\";const ALLOWED_INVALID_COMMANDS=new Set([\"doctor\",\"logs\",\"health\",\"help\",\"status\"]);const ALLOWED_INVALID_GATEWAY_SUBCOMMANDS=new Set([\"status\",\"probe\",\"health\",\"discover\",\"call\",\"install\",\"uninstall\",\"start\",\"stop\",\"restart\"]);let didRunDoctorConfigFlow=false;function formatConfigIssues(issues){return issues.map(issue=>`- ${issue.path||\"<root>\"}: ${issue.message}`)}__name(formatConfigIssues,\"formatConfigIssues\");async function ensureConfigReady(params){if(!didRunDoctorConfigFlow){didRunDoctorConfigFlow=true;await loadAndMaybeMigrateDoctorConfig({options:{nonInteractive:true},confirm:__name(async()=>false,\"confirm\")})}const snapshot=await readConfigFileSnapshot();const commandName=params.commandPath?.[0];const subcommandName=params.commandPath?.[1];const allowInvalid=commandName?ALLOWED_INVALID_COMMANDS.has(commandName)||commandName===\"gateway\"&&subcommandName&&ALLOWED_INVALID_GATEWAY_SUBCOMMANDS.has(subcommandName):false;const issues=snapshot.exists&&!snapshot.valid?formatConfigIssues(snapshot.issues):[];const legacyIssues=snapshot.legacyIssues.length>0?snapshot.legacyIssues.map(issue=>`- ${issue.path}: ${issue.message}`):[];const invalid=snapshot.exists&&!snapshot.valid;if(!invalid)return;const rich=isRich();const muted=__name(value=>colorize(rich,theme.muted,value),\"muted\");const error=__name(value=>colorize(rich,theme.error,value),\"error\");const heading=__name(value=>colorize(rich,theme.heading,value),\"heading\");const commandText=__name(value=>colorize(rich,theme.command,value),\"commandText\");params.runtime.error(heading(\"Config invalid\"));params.runtime.error(`${muted(\"File:\")} ${muted(shortenHomePath(snapshot.path))}`);if(issues.length>0){params.runtime.error(muted(\"Problem:\"));params.runtime.error(issues.map(issue=>`  ${error(issue)}`).join(\"\\n\"))}if(legacyIssues.length>0){params.runtime.error(muted(\"Legacy config keys detected:\"));params.runtime.error(legacyIssues.map(issue=>`  ${error(issue)}`).join(\"\\n\"))}params.runtime.error(\"\");params.runtime.error(`${muted(\"Run:\")} ${commandText(formatCliCommand(\"moltbot doctor --fix\"))}`);if(!allowInvalid){params.runtime.exit(1)}}__name(ensureConfigReady,\"ensureConfigReady\");export{ensureConfigReady};\n","warnings":[],"map":{"version":3,"mappings":"kHAAA,OAAS,2BAA8B,yBACvC,OAAS,oCAAuC,uCAChD,OAAS,SAAU,OAAQ,UAAa,0BAExC,OAAS,qBAAwB,uBACjC,OAAS,oBAAuB,iBAEhC,MAAM,yBAA2B,IAAI,IAAI,CAAC,SAAU,OAAQ,SAAU,OAAQ,QAAQ,CAAC,EACvF,MAAM,oCAAsC,IAAI,IAAI,CAClD,SACA,QACA,SACA,WACA,OACA,UACA,YACA,QACA,OACA,SACF,CAAC,EACD,IAAI,uBAAyB,MAE7B,SAAS,mBAAmB,OAA4D,CACtF,OAAO,OAAO,IAAK,OAAU,KAAK,MAAM,MAAQ,QAAQ,KAAK,MAAM,OAAO,EAAE,CAC9E,CAFS,gDAIT,eAAsB,kBAAkB,OAGtB,CAChB,GAAI,CAAC,uBAAwB,CAC3B,uBAAyB,KACzB,MAAM,gCAAgC,CACpC,QAAS,CAAE,eAAgB,IAAK,EAChC,QAAS,gBAAY,MAAZ,UACX,CAAC,CACH,CAEA,MAAM,SAAW,MAAM,uBAAuB,EAC9C,MAAM,YAAc,OAAO,cAAc,CAAC,EAC1C,MAAM,eAAiB,OAAO,cAAc,CAAC,EAC7C,MAAM,aAAe,YACjB,yBAAyB,IAAI,WAAW,GACvC,cAAgB,WACf,gBACA,oCAAoC,IAAI,cAAc,EACxD,MACJ,MAAM,OAAS,SAAS,QAAU,CAAC,SAAS,MAAQ,mBAAmB,SAAS,MAAM,EAAI,CAAC,EAC3F,MAAM,aACJ,SAAS,aAAa,OAAS,EAC3B,SAAS,aAAa,IAAK,OAAU,KAAK,MAAM,IAAI,KAAK,MAAM,OAAO,EAAE,EACxE,CAAC,EAEP,MAAM,QAAU,SAAS,QAAU,CAAC,SAAS,MAC7C,GAAI,CAAC,QAAS,OAEd,MAAM,KAAO,OAAO,EACpB,MAAM,MAAQ,OAAC,OAAkB,SAAS,KAAM,MAAM,MAAO,KAAK,EAApD,SACd,MAAM,MAAQ,OAAC,OAAkB,SAAS,KAAM,MAAM,MAAO,KAAK,EAApD,SACd,MAAM,QAAU,OAAC,OAAkB,SAAS,KAAM,MAAM,QAAS,KAAK,EAAtD,WAChB,MAAM,YAAc,OAAC,OAAkB,SAAS,KAAM,MAAM,QAAS,KAAK,EAAtD,eAEpB,OAAO,QAAQ,MAAM,QAAQ,gBAAgB,CAAC,EAC9C,OAAO,QAAQ,MAAM,GAAG,MAAM,OAAO,CAAC,IAAI,MAAM,gBAAgB,SAAS,IAAI,CAAC,CAAC,EAAE,EACjF,GAAI,OAAO,OAAS,EAAG,CACrB,OAAO,QAAQ,MAAM,MAAM,UAAU,CAAC,EACtC,OAAO,QAAQ,MAAM,OAAO,IAAK,OAAU,KAAK,MAAM,KAAK,CAAC,EAAE,EAAE,KAAK,IAAI,CAAC,CAC5E,CACA,GAAI,aAAa,OAAS,EAAG,CAC3B,OAAO,QAAQ,MAAM,MAAM,8BAA8B,CAAC,EAC1D,OAAO,QAAQ,MAAM,aAAa,IAAK,OAAU,KAAK,MAAM,KAAK,CAAC,EAAE,EAAE,KAAK,IAAI,CAAC,CAClF,CACA,OAAO,QAAQ,MAAM,EAAE,EACvB,OAAO,QAAQ,MAAM,GAAG,MAAM,MAAM,CAAC,IAAI,YAAY,iBAAiB,sBAAsB,CAAC,CAAC,EAAE,EAChG,GAAI,CAAC,aAAc,CACjB,OAAO,QAAQ,KAAK,CAAC,CACvB,CACF,CAnDsB","names":[],"ignoreList":[],"sources":["/Users/nettomello/CODIGOS/neobot/src/cli/program/config-guard.ts"],"sourcesContent":[null]}}
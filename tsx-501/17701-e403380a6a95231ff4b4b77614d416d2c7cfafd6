{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import fs from\"node:fs\";import path from\"node:path\";import process from\"node:process\";import{fileURLToPath}from\"node:url\";import{loadDotEnv}from\"../infra/dotenv.js\";import{normalizeEnv}from\"../infra/env.js\";import{isMainModule}from\"../infra/is-main.js\";import{ensureMoltbotCliOnPath}from\"../infra/path-env.js\";import{assertSupportedRuntime}from\"../infra/runtime-guard.js\";import{formatUncaughtError}from\"../infra/errors.js\";import{installUnhandledRejectionHandler}from\"../infra/unhandled-rejections.js\";import{enableConsoleCapture}from\"../logging.js\";import{getPrimaryCommand,hasHelpOrVersion}from\"./argv.js\";import{tryRouteCli}from\"./route.js\";function rewriteUpdateFlagArgv(argv){const index=argv.indexOf(\"--update\");if(index===-1)return argv;const next=[...argv];next.splice(index,1,\"update\");return next}__name(rewriteUpdateFlagArgv,\"rewriteUpdateFlagArgv\");async function runCli(argv=process.argv){const normalizedArgv=stripWindowsNodeExec(argv);loadDotEnv({quiet:true});normalizeEnv();ensureMoltbotCliOnPath();assertSupportedRuntime();if(await tryRouteCli(normalizedArgv))return;enableConsoleCapture();const{buildProgram}=await import(\"./program.js\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s});const program=buildProgram();installUnhandledRejectionHandler();process.on(\"uncaughtException\",error=>{console.error(\"[moltbot] Uncaught exception:\",formatUncaughtError(error));process.exit(1)});const parseArgv=rewriteUpdateFlagArgv(normalizedArgv);const primary=getPrimaryCommand(parseArgv);if(primary){const{registerSubCliByName}=await import(\"./program/register.subclis.js\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s});await registerSubCliByName(program,primary)}const shouldSkipPluginRegistration=!primary&&hasHelpOrVersion(parseArgv);if(!shouldSkipPluginRegistration){const{registerPluginCliCommands}=await import(\"../plugins/cli.js\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s});const{loadConfig}=await import(\"../config/config.js\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s});registerPluginCliCommands(program,loadConfig())}await program.parseAsync(parseArgv)}__name(runCli,\"runCli\");function stripWindowsNodeExec(argv){if(process.platform!==\"win32\")return argv;const stripControlChars=__name(value=>{let out=\"\";for(let i=0;i<value.length;i+=1){const code=value.charCodeAt(i);if(code>=32&&code!==127){out+=value[i]}}return out},\"stripControlChars\");const normalizeArg=__name(value=>stripControlChars(value).replace(/^['\"]+|['\"]+$/g,\"\").trim(),\"normalizeArg\");const normalizeCandidate=__name(value=>normalizeArg(value).replace(/^\\\\\\\\\\\\?\\\\/,\"\"),\"normalizeCandidate\");const execPath=normalizeCandidate(process.execPath);const execPathLower=execPath.toLowerCase();const execBase=path.basename(execPath).toLowerCase();const isExecPath=__name(value=>{if(!value)return false;const normalized=normalizeCandidate(value);if(!normalized)return false;const lower=normalized.toLowerCase();return lower===execPathLower||path.basename(lower)===execBase||lower.endsWith(\"\\\\node.exe\")||lower.endsWith(\"/node.exe\")||lower.includes(\"node.exe\")||path.basename(lower)===\"node.exe\"&&fs.existsSync(normalized)},\"isExecPath\");const filtered=argv.filter((arg,index)=>index===0||!isExecPath(arg));if(filtered.length<3)return filtered;const cleaned=[...filtered];if(isExecPath(cleaned[1])){cleaned.splice(1,1)}if(isExecPath(cleaned[2])){cleaned.splice(2,1)}return cleaned}__name(stripWindowsNodeExec,\"stripWindowsNodeExec\");function isCliMainModule(){return isMainModule({currentFile:fileURLToPath(import.meta.url)})}__name(isCliMainModule,\"isCliMainModule\");export{isCliMainModule,rewriteUpdateFlagArgv,runCli};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/nettomello/CODIGOS/neobot/src/cli/run-main.ts"],"sourcesContent":[null]}}
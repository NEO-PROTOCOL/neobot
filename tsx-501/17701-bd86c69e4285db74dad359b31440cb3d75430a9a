{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{createRequire}from\"node:module\";import util from\"node:util\";import{isVerbose}from\"../globals.js\";import{stripAnsi}from\"../terminal/ansi.js\";import{normalizeLogLevel}from\"./levels.js\";import{getLogger}from\"./logger.js\";import{readLoggingConfig}from\"./config.js\";import{loggingState}from\"./state.js\";const requireConfig=createRequire(import.meta.url);function normalizeConsoleLevel(level){if(isVerbose())return\"debug\";return normalizeLogLevel(level,\"info\")}__name(normalizeConsoleLevel,\"normalizeConsoleLevel\");function normalizeConsoleStyle(style){if(style===\"compact\"||style===\"json\"||style===\"pretty\"){return style}if(!process.stdout.isTTY)return\"compact\";return\"pretty\"}__name(normalizeConsoleStyle,\"normalizeConsoleStyle\");function resolveConsoleSettings(){let cfg=loggingState.overrideSettings??readLoggingConfig();if(!cfg){if(loggingState.resolvingConsoleSettings){cfg=void 0}else{loggingState.resolvingConsoleSettings=true;try{const loaded=requireConfig(\"../config/config.js\");cfg=loaded.loadConfig?.().logging}catch{cfg=void 0}finally{loggingState.resolvingConsoleSettings=false}}}const level=normalizeConsoleLevel(cfg?.consoleLevel);const style=normalizeConsoleStyle(cfg?.consoleStyle);return{level,style}}__name(resolveConsoleSettings,\"resolveConsoleSettings\");function consoleSettingsChanged(a,b){if(!a)return true;return a.level!==b.level||a.style!==b.style}__name(consoleSettingsChanged,\"consoleSettingsChanged\");function getConsoleSettings(){const settings=resolveConsoleSettings();const cached=loggingState.cachedConsoleSettings;if(!cached||consoleSettingsChanged(cached,settings)){loggingState.cachedConsoleSettings=settings}return loggingState.cachedConsoleSettings}__name(getConsoleSettings,\"getConsoleSettings\");function getResolvedConsoleSettings(){return getConsoleSettings()}__name(getResolvedConsoleSettings,\"getResolvedConsoleSettings\");function routeLogsToStderr(){loggingState.forceConsoleToStderr=true}__name(routeLogsToStderr,\"routeLogsToStderr\");function setConsoleSubsystemFilter(filters){if(!filters||filters.length===0){loggingState.consoleSubsystemFilter=null;return}const normalized=filters.map(value=>value.trim()).filter(value=>value.length>0);loggingState.consoleSubsystemFilter=normalized.length>0?normalized:null}__name(setConsoleSubsystemFilter,\"setConsoleSubsystemFilter\");function setConsoleTimestampPrefix(enabled){loggingState.consoleTimestampPrefix=enabled}__name(setConsoleTimestampPrefix,\"setConsoleTimestampPrefix\");function shouldLogSubsystemToConsole(subsystem){const filter=loggingState.consoleSubsystemFilter;if(!filter||filter.length===0){return true}return filter.some(prefix=>subsystem===prefix||subsystem.startsWith(`${prefix}/`))}__name(shouldLogSubsystemToConsole,\"shouldLogSubsystemToConsole\");const SUPPRESSED_CONSOLE_PREFIXES=[\"Closing session:\",\"Opening session:\",\"Removing old closed session:\",\"Session already closed\",\"Session already open\"];function shouldSuppressConsoleMessage(message){if(isVerbose())return false;if(SUPPRESSED_CONSOLE_PREFIXES.some(prefix=>message.startsWith(prefix))){return true}if(message.startsWith(\"[EventQueue] Slow listener detected\")&&message.includes(\"DiscordMessageListener\")){return true}return false}__name(shouldSuppressConsoleMessage,\"shouldSuppressConsoleMessage\");function isEpipeError(err){const code=err?.code;return code===\"EPIPE\"||code===\"EIO\"}__name(isEpipeError,\"isEpipeError\");function formatConsoleTimestamp(style){const now=new Date().toISOString();if(style===\"pretty\")return now.slice(11,19);return now}__name(formatConsoleTimestamp,\"formatConsoleTimestamp\");function hasTimestampPrefix(value){return/^(?:\\d{2}:\\d{2}:\\d{2}|\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?Z?)/.test(value)}__name(hasTimestampPrefix,\"hasTimestampPrefix\");function isJsonPayload(value){const trimmed=value.trim();if(!trimmed.startsWith(\"{\")&&!trimmed.startsWith(\"[\"))return false;try{JSON.parse(trimmed);return true}catch{return false}}__name(isJsonPayload,\"isJsonPayload\");function enableConsoleCapture(){if(loggingState.consolePatched)return;loggingState.consolePatched=true;let logger=null;const getLoggerLazy=__name(()=>{if(!logger){logger=getLogger()}return logger},\"getLoggerLazy\");const original={log:console.log,info:console.info,warn:console.warn,error:console.error,debug:console.debug,trace:console.trace};loggingState.rawConsole={log:original.log,info:original.info,warn:original.warn,error:original.error};const forward=__name((level,orig)=>(...args)=>{const formatted=util.format(...args);if(shouldSuppressConsoleMessage(formatted))return;const trimmed=stripAnsi(formatted).trimStart();const shouldPrefixTimestamp=loggingState.consoleTimestampPrefix&&trimmed.length>0&&!hasTimestampPrefix(trimmed)&&!isJsonPayload(trimmed);const timestamp=shouldPrefixTimestamp?formatConsoleTimestamp(getConsoleSettings().style):\"\";try{const resolvedLogger=getLoggerLazy();if(level===\"trace\"){resolvedLogger.trace(formatted)}else if(level===\"debug\"){resolvedLogger.debug(formatted)}else if(level===\"info\"){resolvedLogger.info(formatted)}else if(level===\"warn\"){resolvedLogger.warn(formatted)}else if(level===\"error\"||level===\"fatal\"){resolvedLogger.error(formatted)}else{resolvedLogger.info(formatted)}}catch{}if(loggingState.forceConsoleToStderr){try{const line=timestamp?`${timestamp} ${formatted}`:formatted;process.stderr.write(`${line}\n`)}catch(err){if(isEpipeError(err))return;throw err}}else{try{if(!timestamp){orig.apply(console,args);return}if(args.length===0){orig.call(console,timestamp);return}if(typeof args[0]===\"string\"){orig.call(console,`${timestamp} ${args[0]}`,...args.slice(1));return}orig.call(console,timestamp,...args)}catch(err){if(isEpipeError(err))return;throw err}}},\"forward\");console.log=forward(\"info\",original.log);console.info=forward(\"info\",original.info);console.warn=forward(\"warn\",original.warn);console.error=forward(\"error\",original.error);console.debug=forward(\"debug\",original.debug);console.trace=forward(\"trace\",original.trace)}__name(enableConsoleCapture,\"enableConsoleCapture\");export{enableConsoleCapture,getConsoleSettings,getResolvedConsoleSettings,routeLogsToStderr,setConsoleSubsystemFilter,setConsoleTimestampPrefix,shouldLogSubsystemToConsole};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/nettomello/CODIGOS/neobot/src/logging/console.ts"],"sourcesContent":[null]}}
{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{config}from\"dotenv\";import*as fs from\"node:fs/promises\";import*as path from\"node:path\";import{MioIdentityManager}from\"./mio-system.js\";import{NEO_IDENTITY_TEMPLATES}from\"./registry.js\";const rootDir=process.cwd();config({path:path.join(rootDir,\".env\")});config({path:path.join(rootDir,\".neo-identities\",\".env\")});const ENV_MAP={\"mio-core\":\"NEO_CORE_PRIVATE_KEY\",\"mio-gateway\":\"NEO_GATEWAY_PRIVATE_KEY\",\"mio-skills\":\"NEO_SKILLS_PRIVATE_KEY\",\"mio-factory\":\"NEO_FACTORY_PRIVATE_KEY\",\"mio-flowpay\":\"NEO_FLOWPAY_PRIVATE_KEY\",\"mio-asi1\":\"NEO_ASI1_PRIVATE_KEY\",\"mio-telegram\":\"NEO_TELEGRAM_PRIVATE_KEY\",\"mio-whatsapp\":\"NEO_WHATSAPP_PRIVATE_KEY\",\"mio-ipfs\":\"NEO_IPFS_PRIVATE_KEY\",\"mio-warrior\":\"NEO_WARRIOR_PRIVATE_KEY\"};class IdentityLoader{static{__name(this,\"IdentityLoader\")}static instance;loadedIdentities=new Map;constructor(){}static getInstance(){if(!IdentityLoader.instance){IdentityLoader.instance=new IdentityLoader}return IdentityLoader.instance}async loadAll(){let count=0;for(const template of NEO_IDENTITY_TEMPLATES){const envVar=ENV_MAP[template.id];const privateKey=process.env[envVar];if(privateKey){try{const manager=new MioIdentityManager(privateKey);const jsonPath=path.join(\".neo-identities\",`${template.id}.json`);let identity;try{const jsonContent=await fs.readFile(jsonPath,\"utf-8\");identity=manager.fromJSON(jsonContent)}catch{identity=await manager.createIdentity(template.metadata,{roles:[template.role],permissions:template.permissions})}this.loadedIdentities.set(template.id,{identity,manager});count++}catch(error){console.error(`[MIO-LOADER] Failed to load identity ${template.id}:`,error)}}}return count}getIdentity(id){return this.loadedIdentities.get(id)}getWarrior(){return this.getIdentity(\"mio-warrior\")}async signAsWarrior(message){const warrior=this.getWarrior();if(!warrior)return void 0;return await warrior.manager.signMessage(message)}listLoaded(){return Array.from(this.loadedIdentities.keys())}}const identityLoader=IdentityLoader.getInstance();export{IdentityLoader,identityLoader};\n","warnings":[],"map":{"version":3,"mappings":"kHAAA,OAAS,WAAc,SACvB,UAAY,OAAQ,mBACpB,UAAY,SAAU,YACtB,OAAS,uBAA4C,kBACrD,OAAS,2BAA8B,gBAGvC,MAAM,QAAU,QAAQ,IAAI,EAC5B,OAAO,CAAE,KAAM,KAAK,KAAK,QAAS,MAAM,CAAE,CAAC,EAC3C,OAAO,CAAE,KAAM,KAAK,KAAK,QAAS,kBAAmB,MAAM,CAAE,CAAC,EAK9D,MAAM,QAAkC,CACpC,WAAY,uBACZ,cAAe,0BACf,aAAc,yBACd,cAAe,0BACf,cAAe,0BACf,WAAY,uBACZ,eAAgB,2BAChB,eAAgB,2BAChB,WAAY,uBACZ,cAAe,yBACnB,EAUO,MAAM,cAAe,CAnC5B,MAmC4B,+BACxB,OAAe,SACP,iBAAgD,IAAI,IAEpD,aAAc,CAAE,CAExB,OAAc,aAA8B,CACxC,GAAI,CAAC,eAAe,SAAU,CAC1B,eAAe,SAAW,IAAI,cAClC,CACA,OAAO,eAAe,QAC1B,CAKA,MAAa,SAA2B,CACpC,IAAI,MAAQ,EACZ,UAAW,YAAY,uBAAwB,CAC3C,MAAM,OAAS,QAAQ,SAAS,EAAE,EAClC,MAAM,WAAa,QAAQ,IAAI,MAAM,EAErC,GAAI,WAAY,CACZ,GAAI,CACA,MAAM,QAAU,IAAI,mBAAmB,UAAU,EAGjD,MAAM,SAAW,KAAK,KAAK,kBAAmB,GAAG,SAAS,EAAE,OAAO,EACnE,IAAI,SAEJ,GAAI,CACA,MAAM,YAAc,MAAM,GAAG,SAAS,SAAU,OAAO,EACvD,SAAW,QAAQ,SAAS,WAAW,CAC3C,MAAQ,CAEJ,SAAW,MAAM,QAAQ,eAAe,SAAS,SAAU,CACvD,MAAO,CAAC,SAAS,IAAI,EACrB,YAAa,SAAS,WAC1B,CAAC,CACL,CAEA,KAAK,iBAAiB,IAAI,SAAS,GAAI,CAAE,SAAU,OAAQ,CAAC,EAC5D,OACJ,OAAS,MAAO,CACZ,QAAQ,MAAM,wCAAwC,SAAS,EAAE,IAAK,KAAK,CAC/E,CACJ,CACJ,CACA,OAAO,KACX,CAKO,YAAY,GAAwC,CACvD,OAAO,KAAK,iBAAiB,IAAI,EAAE,CACvC,CAKO,YAAyC,CAC5C,OAAO,KAAK,YAAY,aAAa,CACzC,CAKA,MAAa,cAAc,QAA8C,CACrE,MAAM,QAAU,KAAK,WAAW,EAChC,GAAI,CAAC,QAAS,OAAO,OACrB,OAAO,MAAM,QAAQ,QAAQ,YAAY,OAAO,CACpD,CAKO,YAAuB,CAC1B,OAAO,MAAM,KAAK,KAAK,iBAAiB,KAAK,CAAC,CAClD,CACJ,CAEO,MAAM,eAAiB,eAAe,YAAY","names":[],"ignoreList":[],"sources":["/Users/nettomello/CODIGOS/neobot/src/neo/identity/loader.ts"],"sourcesContent":[null]}}
{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import os from\"node:os\";import path from\"node:path\";import{resolveStateDir}from\"../config/paths.js\";import{DEFAULT_AGENT_ID,normalizeAgentId,parseAgentSessionKey}from\"../routing/session-key.js\";import{resolveUserPath}from\"../utils.js\";import{DEFAULT_AGENT_WORKSPACE_DIR}from\"./workspace.js\";import{resolveAgentIdFromSessionKey}from\"../routing/session-key.js\";let defaultAgentWarned=false;function listAgents(cfg){const list=cfg.agents?.list;if(!Array.isArray(list))return[];return list.filter(entry=>Boolean(entry&&typeof entry===\"object\"))}__name(listAgents,\"listAgents\");function listAgentIds(cfg){const agents=listAgents(cfg);if(agents.length===0)return[DEFAULT_AGENT_ID];const seen=new Set;const ids=[];for(const entry of agents){const id=normalizeAgentId(entry?.id);if(seen.has(id))continue;seen.add(id);ids.push(id)}return ids.length>0?ids:[DEFAULT_AGENT_ID]}__name(listAgentIds,\"listAgentIds\");function resolveDefaultAgentId(cfg){const agents=listAgents(cfg);if(agents.length===0)return DEFAULT_AGENT_ID;const defaults=agents.filter(agent=>agent?.default);if(defaults.length>1&&!defaultAgentWarned){defaultAgentWarned=true;console.warn(\"Multiple agents marked default=true; using the first entry as default.\")}const chosen=(defaults[0]??agents[0])?.id?.trim();return normalizeAgentId(chosen||DEFAULT_AGENT_ID)}__name(resolveDefaultAgentId,\"resolveDefaultAgentId\");function resolveSessionAgentIds(params){const defaultAgentId=resolveDefaultAgentId(params.config??{});const sessionKey=params.sessionKey?.trim();const normalizedSessionKey=sessionKey?sessionKey.toLowerCase():void 0;const parsed=normalizedSessionKey?parseAgentSessionKey(normalizedSessionKey):null;const sessionAgentId=parsed?.agentId?normalizeAgentId(parsed.agentId):defaultAgentId;return{defaultAgentId,sessionAgentId}}__name(resolveSessionAgentIds,\"resolveSessionAgentIds\");function resolveSessionAgentId(params){return resolveSessionAgentIds(params).sessionAgentId}__name(resolveSessionAgentId,\"resolveSessionAgentId\");function resolveAgentEntry(cfg,agentId){const id=normalizeAgentId(agentId);return listAgents(cfg).find(entry=>normalizeAgentId(entry.id)===id)}__name(resolveAgentEntry,\"resolveAgentEntry\");function resolveAgentConfig(cfg,agentId){const id=normalizeAgentId(agentId);const entry=resolveAgentEntry(cfg,id);if(!entry)return void 0;return{name:typeof entry.name===\"string\"?entry.name:void 0,workspace:typeof entry.workspace===\"string\"?entry.workspace:void 0,agentDir:typeof entry.agentDir===\"string\"?entry.agentDir:void 0,model:typeof entry.model===\"string\"||entry.model&&typeof entry.model===\"object\"?entry.model:void 0,memorySearch:entry.memorySearch,humanDelay:entry.humanDelay,heartbeat:entry.heartbeat,identity:entry.identity,groupChat:entry.groupChat,subagents:typeof entry.subagents===\"object\"&&entry.subagents?entry.subagents:void 0,sandbox:entry.sandbox,tools:entry.tools}}__name(resolveAgentConfig,\"resolveAgentConfig\");function resolveAgentModelPrimary(cfg,agentId){const raw=resolveAgentConfig(cfg,agentId)?.model;if(!raw)return void 0;if(typeof raw===\"string\")return raw.trim()||void 0;const primary=raw.primary?.trim();return primary||void 0}__name(resolveAgentModelPrimary,\"resolveAgentModelPrimary\");function resolveAgentModelFallbacksOverride(cfg,agentId){const raw=resolveAgentConfig(cfg,agentId)?.model;if(!raw||typeof raw===\"string\")return void 0;if(!Object.hasOwn(raw,\"fallbacks\"))return void 0;return Array.isArray(raw.fallbacks)?raw.fallbacks:void 0}__name(resolveAgentModelFallbacksOverride,\"resolveAgentModelFallbacksOverride\");function resolveAgentWorkspaceDir(cfg,agentId){const id=normalizeAgentId(agentId);const configured=resolveAgentConfig(cfg,id)?.workspace?.trim();if(configured)return resolveUserPath(configured);const defaultAgentId=resolveDefaultAgentId(cfg);if(id===defaultAgentId){const fallback=cfg.agents?.defaults?.workspace?.trim();if(fallback)return resolveUserPath(fallback);return DEFAULT_AGENT_WORKSPACE_DIR}return path.join(os.homedir(),`clawd-${id}`)}__name(resolveAgentWorkspaceDir,\"resolveAgentWorkspaceDir\");function resolveAgentDir(cfg,agentId){const id=normalizeAgentId(agentId);const configured=resolveAgentConfig(cfg,id)?.agentDir?.trim();if(configured)return resolveUserPath(configured);const root=resolveStateDir(process.env,os.homedir);return path.join(root,\"agents\",id,\"agent\")}__name(resolveAgentDir,\"resolveAgentDir\");export{listAgentIds,resolveAgentConfig,resolveAgentDir,resolveAgentIdFromSessionKey,resolveAgentModelFallbacksOverride,resolveAgentModelPrimary,resolveAgentWorkspaceDir,resolveDefaultAgentId,resolveSessionAgentId,resolveSessionAgentIds};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/nettomello/CODIGOS/neobot/src/agents/agent-scope.ts"],"sourcesContent":[null]}}
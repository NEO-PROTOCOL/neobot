{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import fs from\"node:fs\";import os from\"node:os\";import path from\"node:path\";import{resolveOAuthDir}from\"./config/paths.js\";import{logVerbose,shouldLogVerbose}from\"./globals.js\";async function ensureDir(dir){await fs.promises.mkdir(dir,{recursive:true})}__name(ensureDir,\"ensureDir\");function clampNumber(value,min,max){return Math.max(min,Math.min(max,value))}__name(clampNumber,\"clampNumber\");function clampInt(value,min,max){return clampNumber(Math.floor(value),min,max)}__name(clampInt,\"clampInt\");function assertWebChannel(input){if(input!==\"web\"){throw new Error(\"Web channel must be 'web'\")}}__name(assertWebChannel,\"assertWebChannel\");function normalizePath(p){if(!p.startsWith(\"/\"))return`/${p}`;return p}__name(normalizePath,\"normalizePath\");function withWhatsAppPrefix(number){return number.startsWith(\"whatsapp:\")?number:`whatsapp:${number}`}__name(withWhatsAppPrefix,\"withWhatsAppPrefix\");function normalizeE164(number){const withoutPrefix=number.replace(/^whatsapp:/,\"\").trim();const digits=withoutPrefix.replace(/[^\\d+]/g,\"\");if(digits.startsWith(\"+\"))return`+${digits.slice(1)}`;return`+${digits}`}__name(normalizeE164,\"normalizeE164\");function isSelfChatMode(selfE164,allowFrom){if(!selfE164)return false;if(!Array.isArray(allowFrom)||allowFrom.length===0)return false;const normalizedSelf=normalizeE164(selfE164);return allowFrom.some(n=>{if(n===\"*\")return false;try{return normalizeE164(String(n))===normalizedSelf}catch{return false}})}__name(isSelfChatMode,\"isSelfChatMode\");function toWhatsappJid(number){const withoutPrefix=number.replace(/^whatsapp:/,\"\").trim();if(withoutPrefix.includes(\"@\"))return withoutPrefix;const e164=normalizeE164(withoutPrefix);const digits=e164.replace(/\\D/g,\"\");return`${digits}@s.whatsapp.net`}__name(toWhatsappJid,\"toWhatsappJid\");function resolveLidMappingDirs(opts){const dirs=new Set;const addDir=__name(dir=>{if(!dir)return;dirs.add(resolveUserPath(dir))},\"addDir\");addDir(opts?.authDir);for(const dir of opts?.lidMappingDirs??[])addDir(dir);addDir(resolveOAuthDir());addDir(path.join(CONFIG_DIR,\"credentials\"));return[...dirs]}__name(resolveLidMappingDirs,\"resolveLidMappingDirs\");function readLidReverseMapping(lid,opts){const mappingFilename=`lid-mapping-${lid}_reverse.json`;const mappingDirs=resolveLidMappingDirs(opts);for(const dir of mappingDirs){const mappingPath=path.join(dir,mappingFilename);try{const data=fs.readFileSync(mappingPath,\"utf8\");const phone=JSON.parse(data);if(phone===null||phone===void 0)continue;return normalizeE164(String(phone))}catch{}}return null}__name(readLidReverseMapping,\"readLidReverseMapping\");function jidToE164(jid,opts){const match=jid.match(/^(\\d+)(?::\\d+)?@(s\\.whatsapp\\.net|hosted)$/);if(match){const digits=match[1];return`+${digits}`}const lidMatch=jid.match(/^(\\d+)(?::\\d+)?@(lid|hosted\\.lid)$/);if(lidMatch){const lid=lidMatch[1];const phone=readLidReverseMapping(lid,opts);if(phone)return phone;const shouldLog=opts?.logMissing??shouldLogVerbose();if(shouldLog){logVerbose(`LID mapping not found for ${lid}; skipping inbound message`)}}return null}__name(jidToE164,\"jidToE164\");async function resolveJidToE164(jid,opts){if(!jid)return null;const direct=jidToE164(jid,opts);if(direct)return direct;if(!/(@lid|@hosted\\.lid)$/.test(jid))return null;if(!opts?.lidLookup?.getPNForLID)return null;try{const pnJid=await opts.lidLookup.getPNForLID(jid);if(!pnJid)return null;return jidToE164(pnJid,opts)}catch(err){if(shouldLogVerbose()){logVerbose(`LID mapping lookup failed for ${jid}: ${String(err)}`)}return null}}__name(resolveJidToE164,\"resolveJidToE164\");function sleep(ms){return new Promise(resolve=>setTimeout(resolve,ms))}__name(sleep,\"sleep\");function isHighSurrogate(codeUnit){return codeUnit>=55296&&codeUnit<=56319}__name(isHighSurrogate,\"isHighSurrogate\");function isLowSurrogate(codeUnit){return codeUnit>=56320&&codeUnit<=57343}__name(isLowSurrogate,\"isLowSurrogate\");function sliceUtf16Safe(input,start,end){const len=input.length;let from=start<0?Math.max(len+start,0):Math.min(start,len);let to=end===void 0?len:end<0?Math.max(len+end,0):Math.min(end,len);if(to<from){const tmp=from;from=to;to=tmp}if(from>0&&from<len){const codeUnit=input.charCodeAt(from);if(isLowSurrogate(codeUnit)&&isHighSurrogate(input.charCodeAt(from-1))){from+=1}}if(to>0&&to<len){const codeUnit=input.charCodeAt(to-1);if(isHighSurrogate(codeUnit)&&isLowSurrogate(input.charCodeAt(to))){to-=1}}return input.slice(from,to)}__name(sliceUtf16Safe,\"sliceUtf16Safe\");function truncateUtf16Safe(input,maxLen){const limit=Math.max(0,Math.floor(maxLen));if(input.length<=limit)return input;return sliceUtf16Safe(input,0,limit)}__name(truncateUtf16Safe,\"truncateUtf16Safe\");function resolveUserPath(input){const trimmed=input.trim();if(!trimmed)return trimmed;if(trimmed.startsWith(\"~\")){const expanded=trimmed.replace(/^~(?=$|[\\\\/])/,os.homedir());return path.resolve(expanded)}return path.resolve(trimmed)}__name(resolveUserPath,\"resolveUserPath\");function resolveConfigDir(env=process.env,homedir=os.homedir){const override=env.CLAWDBOT_STATE_DIR?.trim();if(override)return resolveUserPath(override);return path.join(homedir(),\".clawdbot\")}__name(resolveConfigDir,\"resolveConfigDir\");function resolveHomeDir(){const envHome=process.env.HOME?.trim();if(envHome)return envHome;const envProfile=process.env.USERPROFILE?.trim();if(envProfile)return envProfile;try{const home=os.homedir();return home?.trim()?home:void 0}catch{return void 0}}__name(resolveHomeDir,\"resolveHomeDir\");function shortenHomePath(input){if(!input)return input;const home=resolveHomeDir();if(!home)return input;if(input===home)return\"~\";if(input.startsWith(`${home}/`))return`~${input.slice(home.length)}`;return input}__name(shortenHomePath,\"shortenHomePath\");function shortenHomeInString(input){if(!input)return input;const home=resolveHomeDir();if(!home)return input;return input.split(home).join(\"~\")}__name(shortenHomeInString,\"shortenHomeInString\");function displayPath(input){return shortenHomePath(input)}__name(displayPath,\"displayPath\");function displayString(input){return shortenHomeInString(input)}__name(displayString,\"displayString\");function formatTerminalLink(label,url,opts){const esc=\"\\x1B\";const safeLabel=label.replaceAll(esc,\"\");const safeUrl=url.replaceAll(esc,\"\");const allow=opts?.force===true?true:opts?.force===false?false:Boolean(process.stdout.isTTY);if(!allow){return opts?.fallback??`${safeLabel} (${safeUrl})`}return`\\x1B]8;;${safeUrl}\\x07${safeLabel}\\x1B]8;;\\x07`}__name(formatTerminalLink,\"formatTerminalLink\");const CONFIG_DIR=resolveConfigDir();export{CONFIG_DIR,assertWebChannel,clampInt,clampNumber,displayPath,displayString,ensureDir,formatTerminalLink,isSelfChatMode,jidToE164,normalizeE164,normalizePath,resolveConfigDir,resolveHomeDir,resolveJidToE164,resolveUserPath,shortenHomeInString,shortenHomePath,sleep,sliceUtf16Safe,toWhatsappJid,truncateUtf16Safe,withWhatsAppPrefix};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/nettomello/CODIGOS/neobot/src/utils.ts"],"sourcesContent":[null]}}
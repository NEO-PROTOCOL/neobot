{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{DEFAULT_CHAT_CHANNEL}from\"../../channels/registry.js\";import{agentCliCommand}from\"../../commands/agent-via-gateway.js\";import{agentsAddCommand,agentsDeleteCommand,agentsListCommand,agentsSetIdentityCommand}from\"../../commands/agents.js\";import{setVerbose}from\"../../globals.js\";import{defaultRuntime}from\"../../runtime.js\";import{formatDocsLink}from\"../../terminal/links.js\";import{theme}from\"../../terminal/theme.js\";import{hasExplicitOptions}from\"../command-options.js\";import{formatHelpExamples}from\"../help-format.js\";import{createDefaultDeps}from\"../deps.js\";import{runCommandWithRuntime}from\"../cli-utils.js\";import{collectOption}from\"./helpers.js\";function registerAgentCommands(program,args){program.command(\"agent\").description(\"Run an agent turn via the Gateway (use --local for embedded)\").requiredOption(\"-m, --message <text>\",\"Message body for the agent\").option(\"-t, --to <number>\",\"Recipient number in E.164 used to derive the session key\").option(\"--session-id <id>\",\"Use an explicit session id\").option(\"--agent <id>\",\"Agent id (overrides routing bindings)\").option(\"--thinking <level>\",\"Thinking level: off | minimal | low | medium | high\").option(\"--verbose <on|off>\",\"Persist agent verbose level for the session\").option(\"--channel <channel>\",`Delivery channel: ${args.agentChannelOptions} (default: ${DEFAULT_CHAT_CHANNEL})`).option(\"--reply-to <target>\",\"Delivery target override (separate from session routing)\").option(\"--reply-channel <channel>\",\"Delivery channel override (separate from routing)\").option(\"--reply-account <id>\",\"Delivery account id override\").option(\"--local\",\"Run the embedded agent locally (requires model provider API keys in your shell)\",false).option(\"--deliver\",\"Send the agent's reply back to the selected channel\",false).option(\"--json\",\"Output result as JSON\",false).option(\"--timeout <seconds>\",\"Override agent command timeout (seconds, default 600 or config value)\").addHelpText(\"after\",()=>`\n${theme.heading(\"Examples:\")}\n${formatHelpExamples([['moltbot agent --to +5562983231110 --message \"status update\"',\"Start a new session.\"],['moltbot agent --agent ops --message \"Summarize logs\"',\"Use a specific agent.\"],['moltbot agent --session-id 1234 --message \"Summarize inbox\" --thinking medium',\"Target a session with explicit thinking level.\"],['moltbot agent --to +5562983231110 --message \"Trace logs\" --verbose on --json',\"Enable verbose logging and JSON output.\"],['moltbot agent --to +5562983231110 --message \"Summon reply\" --deliver',\"Deliver reply.\"],['moltbot agent --agent ops --message \"Generate report\" --deliver --reply-channel slack --reply-to \"#reports\"',\"Send reply to a different channel/target.\"]])}\n\n${theme.muted(\"Docs:\")} ${formatDocsLink(\"/cli/agent\",\"docs.molt.bot/cli/agent\")}`).action(async opts=>{const verboseLevel=typeof opts.verbose===\"string\"?opts.verbose.toLowerCase():\"\";setVerbose(verboseLevel===\"on\");const deps=createDefaultDeps();await runCommandWithRuntime(defaultRuntime,async()=>{await agentCliCommand(opts,defaultRuntime,deps)})});const agents=program.command(\"agents\").description(\"Manage isolated agents (workspaces + auth + routing)\").addHelpText(\"after\",()=>`\n${theme.muted(\"Docs:\")} ${formatDocsLink(\"/cli/agents\",\"docs.molt.bot/cli/agents\")}\n`);agents.command(\"list\").description(\"List configured agents\").option(\"--json\",\"Output JSON instead of text\",false).option(\"--bindings\",\"Include routing bindings\",false).action(async opts=>{await runCommandWithRuntime(defaultRuntime,async()=>{await agentsListCommand({json:Boolean(opts.json),bindings:Boolean(opts.bindings)},defaultRuntime)})});agents.command(\"add [name]\").description(\"Add a new isolated agent\").option(\"--workspace <dir>\",\"Workspace directory for the new agent\").option(\"--model <id>\",\"Model id for this agent\").option(\"--agent-dir <dir>\",\"Agent state directory for this agent\").option(\"--bind <channel[:accountId]>\",\"Route channel binding (repeatable)\",collectOption,[]).option(\"--non-interactive\",\"Disable prompts; requires --workspace\",false).option(\"--json\",\"Output JSON summary\",false).action(async(name,opts,command)=>{await runCommandWithRuntime(defaultRuntime,async()=>{const hasFlags=hasExplicitOptions(command,[\"workspace\",\"model\",\"agentDir\",\"bind\",\"nonInteractive\"]);await agentsAddCommand({name:typeof name===\"string\"?name:void 0,workspace:opts.workspace,model:opts.model,agentDir:opts.agentDir,bind:Array.isArray(opts.bind)?opts.bind:void 0,nonInteractive:Boolean(opts.nonInteractive),json:Boolean(opts.json)},defaultRuntime,{hasFlags})})});agents.command(\"set-identity\").description(\"Update an agent identity (name/theme/emoji/avatar)\").option(\"--agent <id>\",\"Agent id to update\").option(\"--workspace <dir>\",\"Workspace directory used to locate the agent + IDENTITY.md\").option(\"--identity-file <path>\",\"Explicit IDENTITY.md path to read\").option(\"--from-identity\",\"Read values from IDENTITY.md\",false).option(\"--name <name>\",\"Identity name\").option(\"--theme <theme>\",\"Identity theme\").option(\"--emoji <emoji>\",\"Identity emoji\").option(\"--avatar <value>\",\"Identity avatar (workspace path, http(s) URL, or data URI)\").option(\"--json\",\"Output JSON summary\",false).addHelpText(\"after\",()=>`\n${theme.heading(\"Examples:\")}\n${formatHelpExamples([['moltbot agents set-identity --agent main --name \"Clawd\" --emoji \"\\u{1F99E}\"',\"Set name + emoji.\"],[\"moltbot agents set-identity --agent main --avatar avatars/clawd.png\",\"Set avatar path.\"],[\"moltbot agents set-identity --workspace ~/clawd --from-identity\",\"Load from IDENTITY.md.\"],[\"moltbot agents set-identity --identity-file ~/clawd/IDENTITY.md --agent main\",\"Use a specific IDENTITY.md.\"]])}\n`).action(async opts=>{await runCommandWithRuntime(defaultRuntime,async()=>{await agentsSetIdentityCommand({agent:opts.agent,workspace:opts.workspace,identityFile:opts.identityFile,fromIdentity:Boolean(opts.fromIdentity),name:opts.name,theme:opts.theme,emoji:opts.emoji,avatar:opts.avatar,json:Boolean(opts.json)},defaultRuntime)})});agents.command(\"delete <id>\").description(\"Delete an agent and prune workspace/state\").option(\"--force\",\"Skip confirmation\",false).option(\"--json\",\"Output JSON summary\",false).action(async(id,opts)=>{await runCommandWithRuntime(defaultRuntime,async()=>{await agentsDeleteCommand({id:String(id),force:Boolean(opts.force),json:Boolean(opts.json)},defaultRuntime)})});agents.action(async()=>{await runCommandWithRuntime(defaultRuntime,async()=>{await agentsListCommand({},defaultRuntime)})})}__name(registerAgentCommands,\"registerAgentCommands\");export{registerAgentCommands};\n","warnings":[],"map":{"version":3,"mappings":"kHACA,OAAS,yBAA4B,6BACrC,OAAS,oBAAuB,sCAChC,OACE,iBACA,oBACA,kBACA,6BACK,2BACP,OAAS,eAAkB,mBAC3B,OAAS,mBAAsB,mBAC/B,OAAS,mBAAsB,0BAC/B,OAAS,UAAa,0BACtB,OAAS,uBAA0B,wBACnC,OAAS,uBAA0B,oBACnC,OAAS,sBAAyB,aAClC,OAAS,0BAA6B,kBACtC,OAAS,kBAAqB,eAEvB,SAAS,sBAAsB,QAAkB,KAAuC,CAC7F,QACG,QAAQ,OAAO,EACf,YAAY,8DAA8D,EAC1E,eAAe,uBAAwB,4BAA4B,EACnE,OAAO,oBAAqB,0DAA0D,EACtF,OAAO,oBAAqB,4BAA4B,EACxD,OAAO,eAAgB,uCAAuC,EAC9D,OAAO,qBAAsB,qDAAqD,EAClF,OAAO,qBAAsB,6CAA6C,EAC1E,OACC,sBACA,qBAAqB,KAAK,mBAAmB,cAAc,oBAAoB,GACjF,EACC,OAAO,sBAAuB,0DAA0D,EACxF,OAAO,4BAA6B,mDAAmD,EACvF,OAAO,uBAAwB,8BAA8B,EAC7D,OACC,UACA,kFACA,KACF,EACC,OAAO,YAAa,sDAAuD,KAAK,EAChF,OAAO,SAAU,wBAAyB,KAAK,EAC/C,OACC,sBACA,uEACF,EACC,YACC,QACA,IACE;AAAA,EACN,MAAM,QAAQ,WAAW,CAAC;AAAA,EAC1B,mBAAmB,CACnB,CAAC,8DAA+D,sBAAsB,EACtF,CAAC,uDAAwD,uBAAuB,EAChF,CACE,gFACA,gDACF,EACA,CACE,+EACA,yCACF,EACA,CAAC,uEAAwE,gBAAgB,EACzF,CACE,8GACA,2CACF,CACF,CAAC,CAAC;AAAA;AAAA,EAEA,MAAM,MAAM,OAAO,CAAC,IAAI,eAAe,aAAc,yBAAyB,CAAC,EAC7E,EACC,OAAO,MAAO,MAAS,CACtB,MAAM,aAAe,OAAO,KAAK,UAAY,SAAW,KAAK,QAAQ,YAAY,EAAI,GACrF,WAAW,eAAiB,IAAI,EAEhC,MAAM,KAAO,kBAAkB,EAC/B,MAAM,sBAAsB,eAAgB,SAAY,CACtD,MAAM,gBAAgB,KAAM,eAAgB,IAAI,CAClD,CAAC,CACH,CAAC,EAEH,MAAM,OAAS,QACZ,QAAQ,QAAQ,EAChB,YAAY,sDAAsD,EAClE,YACC,QACA,IACE;AAAA,EAAK,MAAM,MAAM,OAAO,CAAC,IAAI,eAAe,cAAe,0BAA0B,CAAC;AAAA,CAC1F,EAEF,OACG,QAAQ,MAAM,EACd,YAAY,wBAAwB,EACpC,OAAO,SAAU,8BAA+B,KAAK,EACrD,OAAO,aAAc,2BAA4B,KAAK,EACtD,OAAO,MAAO,MAAS,CACtB,MAAM,sBAAsB,eAAgB,SAAY,CACtD,MAAM,kBACJ,CAAE,KAAM,QAAQ,KAAK,IAAI,EAAG,SAAU,QAAQ,KAAK,QAAQ,CAAE,EAC7D,cACF,CACF,CAAC,CACH,CAAC,EAEH,OACG,QAAQ,YAAY,EACpB,YAAY,0BAA0B,EACtC,OAAO,oBAAqB,uCAAuC,EACnE,OAAO,eAAgB,yBAAyB,EAChD,OAAO,oBAAqB,sCAAsC,EAClE,OAAO,+BAAgC,qCAAsC,cAAe,CAAC,CAAC,EAC9F,OAAO,oBAAqB,wCAAyC,KAAK,EAC1E,OAAO,SAAU,sBAAuB,KAAK,EAC7C,OAAO,MAAO,KAAM,KAAM,UAAY,CACrC,MAAM,sBAAsB,eAAgB,SAAY,CACtD,MAAM,SAAW,mBAAmB,QAAS,CAC3C,YACA,QACA,WACA,OACA,gBACF,CAAC,EACD,MAAM,iBACJ,CACE,KAAM,OAAO,OAAS,SAAW,KAAO,OACxC,UAAW,KAAK,UAChB,MAAO,KAAK,MACZ,SAAU,KAAK,SACf,KAAM,MAAM,QAAQ,KAAK,IAAI,EAAK,KAAK,KAAoB,OAC3D,eAAgB,QAAQ,KAAK,cAAc,EAC3C,KAAM,QAAQ,KAAK,IAAI,CACzB,EACA,eACA,CAAE,QAAS,CACb,CACF,CAAC,CACH,CAAC,EAEH,OACG,QAAQ,cAAc,EACtB,YAAY,oDAAoD,EAChE,OAAO,eAAgB,oBAAoB,EAC3C,OAAO,oBAAqB,4DAA4D,EACxF,OAAO,yBAA0B,mCAAmC,EACpE,OAAO,kBAAmB,+BAAgC,KAAK,EAC/D,OAAO,gBAAiB,eAAe,EACvC,OAAO,kBAAmB,gBAAgB,EAC1C,OAAO,kBAAmB,gBAAgB,EAC1C,OAAO,mBAAoB,4DAA4D,EACvF,OAAO,SAAU,sBAAuB,KAAK,EAC7C,YACC,QACA,IACE;AAAA,EACN,MAAM,QAAQ,WAAW,CAAC;AAAA,EAC1B,mBAAmB,CACnB,CAAC,8EAAwE,mBAAmB,EAC5F,CAAC,sEAAuE,kBAAkB,EAC1F,CAAC,kEAAmE,wBAAwB,EAC5F,CACE,+EACA,6BACF,CACF,CAAC,CAAC;AAAA,CAEE,EACC,OAAO,MAAO,MAAS,CACtB,MAAM,sBAAsB,eAAgB,SAAY,CACtD,MAAM,yBACJ,CACE,MAAO,KAAK,MACZ,UAAW,KAAK,UAChB,aAAc,KAAK,aACnB,aAAc,QAAQ,KAAK,YAAY,EACvC,KAAM,KAAK,KACX,MAAO,KAAK,MACZ,MAAO,KAAK,MACZ,OAAQ,KAAK,OACb,KAAM,QAAQ,KAAK,IAAI,CACzB,EACA,cACF,CACF,CAAC,CACH,CAAC,EAEH,OACG,QAAQ,aAAa,EACrB,YAAY,2CAA2C,EACvD,OAAO,UAAW,oBAAqB,KAAK,EAC5C,OAAO,SAAU,sBAAuB,KAAK,EAC7C,OAAO,MAAO,GAAI,OAAS,CAC1B,MAAM,sBAAsB,eAAgB,SAAY,CACtD,MAAM,oBACJ,CACE,GAAI,OAAO,EAAE,EACb,MAAO,QAAQ,KAAK,KAAK,EACzB,KAAM,QAAQ,KAAK,IAAI,CACzB,EACA,cACF,CACF,CAAC,CACH,CAAC,EAEH,OAAO,OAAO,SAAY,CACxB,MAAM,sBAAsB,eAAgB,SAAY,CACtD,MAAM,kBAAkB,CAAC,EAAG,cAAc,CAC5C,CAAC,CACH,CAAC,CACH,CA9LgB","names":[],"ignoreList":[],"sources":["/Users/nettomello/CODIGOS/neobot/src/cli/program/register.agent.ts"],"sourcesContent":[null]}}
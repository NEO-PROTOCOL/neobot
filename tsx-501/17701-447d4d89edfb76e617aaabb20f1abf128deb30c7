{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import process from\"node:process\";import{formatUncaughtError}from\"./errors.js\";const handlers=new Set;function isAbortError(err){if(!err||typeof err!==\"object\")return false;const name=\"name\"in err?String(err.name):\"\";if(name===\"AbortError\")return true;const message=\"message\"in err&&typeof err.message===\"string\"?err.message:\"\";if(message===\"This operation was aborted\")return true;return false}__name(isAbortError,\"isAbortError\");const TRANSIENT_NETWORK_CODES=new Set([\"ECONNRESET\",\"ECONNREFUSED\",\"ENOTFOUND\",\"ETIMEDOUT\",\"ESOCKETTIMEDOUT\",\"ECONNABORTED\",\"EPIPE\",\"EHOSTUNREACH\",\"ENETUNREACH\",\"EAI_AGAIN\",\"UND_ERR_CONNECT_TIMEOUT\",\"UND_ERR_SOCKET\",\"UND_ERR_HEADERS_TIMEOUT\",\"UND_ERR_BODY_TIMEOUT\"]);function getErrorCode(err){if(!err||typeof err!==\"object\")return void 0;const code=err.code;return typeof code===\"string\"?code:void 0}__name(getErrorCode,\"getErrorCode\");function getErrorCause(err){if(!err||typeof err!==\"object\")return void 0;return err.cause}__name(getErrorCause,\"getErrorCause\");function isTransientNetworkError(err){if(!err)return false;const code=getErrorCode(err);if(code&&TRANSIENT_NETWORK_CODES.has(code))return true;if(err instanceof TypeError&&err.message===\"fetch failed\"){const cause2=getErrorCause(err);if(cause2)return isTransientNetworkError(cause2);return true}const cause=getErrorCause(err);if(cause&&cause!==err){return isTransientNetworkError(cause)}if(err instanceof AggregateError&&err.errors?.length){return err.errors.some(e=>isTransientNetworkError(e))}return false}__name(isTransientNetworkError,\"isTransientNetworkError\");function registerUnhandledRejectionHandler(handler){handlers.add(handler);return()=>{handlers.delete(handler)}}__name(registerUnhandledRejectionHandler,\"registerUnhandledRejectionHandler\");function isUnhandledRejectionHandled(reason){for(const handler of handlers){try{if(handler(reason))return true}catch(err){console.error(\"[moltbot] Unhandled rejection handler failed:\",err instanceof Error?err.stack??err.message:err)}}return false}__name(isUnhandledRejectionHandled,\"isUnhandledRejectionHandled\");function installUnhandledRejectionHandler(){process.on(\"unhandledRejection\",(reason,_promise)=>{if(isUnhandledRejectionHandled(reason))return;if(isAbortError(reason)){console.warn(\"[moltbot] Suppressed AbortError:\",formatUncaughtError(reason));return}if(isTransientNetworkError(reason)){console.error(\"[moltbot] Network error (non-fatal):\",formatUncaughtError(reason));return}console.error(\"[moltbot] Unhandled promise rejection:\",formatUncaughtError(reason));process.exit(1)})}__name(installUnhandledRejectionHandler,\"installUnhandledRejectionHandler\");export{installUnhandledRejectionHandler,isAbortError,isTransientNetworkError,isUnhandledRejectionHandled,registerUnhandledRejectionHandler};\n","warnings":[],"map":{"version":3,"mappings":"kHAAA,OAAO,YAAa,eAEpB,OAAS,wBAA2B,cAIpC,MAAM,SAAW,IAAI,IAMd,SAAS,aAAa,IAAuB,CAClD,GAAI,CAAC,KAAO,OAAO,MAAQ,SAAU,MAAO,OAC5C,MAAM,KAAO,SAAU,IAAM,OAAO,IAAI,IAAI,EAAI,GAChD,GAAI,OAAS,aAAc,MAAO,MAElC,MAAM,QAAU,YAAa,KAAO,OAAO,IAAI,UAAY,SAAW,IAAI,QAAU,GACpF,GAAI,UAAY,6BAA8B,MAAO,MACrD,MAAO,MACT,CARgB,oCAWhB,MAAM,wBAA0B,IAAI,IAAI,CACtC,aACA,eACA,YACA,YACA,kBACA,eACA,QACA,eACA,cACA,YACA,0BACA,iBACA,0BACA,sBACF,CAAC,EAED,SAAS,aAAa,IAAkC,CACtD,GAAI,CAAC,KAAO,OAAO,MAAQ,SAAU,OAAO,OAC5C,MAAM,KAAQ,IAA2B,KACzC,OAAO,OAAO,OAAS,SAAW,KAAO,MAC3C,CAJS,oCAMT,SAAS,cAAc,IAAuB,CAC5C,GAAI,CAAC,KAAO,OAAO,MAAQ,SAAU,OAAO,OAC5C,OAAQ,IAA4B,KACtC,CAHS,sCASF,SAAS,wBAAwB,IAAuB,CAC7D,GAAI,CAAC,IAAK,MAAO,OAGjB,MAAM,KAAO,aAAa,GAAG,EAC7B,GAAI,MAAQ,wBAAwB,IAAI,IAAI,EAAG,MAAO,MAGtD,GAAI,eAAe,WAAa,IAAI,UAAY,eAAgB,CAC9D,MAAMA,OAAQ,cAAc,GAAG,EAE/B,GAAIA,OAAO,OAAO,wBAAwBA,MAAK,EAE/C,MAAO,KACT,CAGA,MAAM,MAAQ,cAAc,GAAG,EAC/B,GAAI,OAAS,QAAU,IAAK,CAC1B,OAAO,wBAAwB,KAAK,CACtC,CAGA,GAAI,eAAe,gBAAkB,IAAI,QAAQ,OAAQ,CACvD,OAAO,IAAI,OAAO,KAAM,GAAM,wBAAwB,CAAC,CAAC,CAC1D,CAEA,MAAO,MACT,CA5BgB,0DA8BT,SAAS,kCAAkC,QAAgD,CAChG,SAAS,IAAI,OAAO,EACpB,MAAO,IAAM,CACX,SAAS,OAAO,OAAO,CACzB,CACF,CALgB,8EAOT,SAAS,4BAA4B,OAA0B,CACpE,UAAW,WAAW,SAAU,CAC9B,GAAI,CACF,GAAI,QAAQ,MAAM,EAAG,MAAO,KAC9B,OAAS,IAAK,CACZ,QAAQ,MACN,gDACA,eAAe,MAAS,IAAI,OAAS,IAAI,QAAW,GACtD,CACF,CACF,CACA,MAAO,MACT,CAZgB,kEAcT,SAAS,kCAAyC,CACvD,QAAQ,GAAG,qBAAsB,CAAC,OAAQ,WAAa,CACrD,GAAI,4BAA4B,MAAM,EAAG,OAIzC,GAAI,aAAa,MAAM,EAAG,CACxB,QAAQ,KAAK,mCAAoC,oBAAoB,MAAM,CAAC,EAC5E,MACF,CAIA,GAAI,wBAAwB,MAAM,EAAG,CACnC,QAAQ,MAAM,uCAAwC,oBAAoB,MAAM,CAAC,EACjF,MACF,CAEA,QAAQ,MAAM,yCAA0C,oBAAoB,MAAM,CAAC,EACnF,QAAQ,KAAK,CAAC,CAChB,CAAC,CACH,CArBgB","names":["cause"],"ignoreList":[],"sources":["/Users/nettomello/CODIGOS/neobot/src/infra/unhandled-rejections.ts"],"sourcesContent":[null]}}